# Actual AI Chat Guide

## Local Setup

This guide will walk you through setting up LibreChat locally and deploying to Railway.

### Prerequisites

- Node.js (v18 or higher)
- Docker and Docker Compose
- Git
- MongoDB Atlas account
- OpenAI API key

---

## Part 1: MongoDB Atlas Setup

### 1. Create a New Project

1. Log in to [MongoDB Atlas](https://cloud.mongodb.com/)
2. Click "New Project"
3. Name your project (e.g., "LibreChat")
4. Click "Create Project"

### 2. Create a New Cluster

1. Click "Build a Cluster" or "Create" under "Clusters"
2. Choose your cluster tier (Free tier works for testing)
3. Select your cloud provider and region
4. Name your cluster (e.g., "librechat-cluster")
5. Click "Create Cluster" (this may take a few minutes)

### 3. Create Databases

1. Once your cluster is ready, click "Browse Collections"
2. Click "Add My Own Data"
3. Create the **test** database:
   - Database name: `test`
   - Collection name: `rag_vectors`
   - Click "Create"
4. Create the **production** database:
   - Click "Create Database"
   - Database name: `production`
   - Collection name: `rag_vectors`
   - Click "Create"

### 4. Set Up Database Users

#### Admin User

1. Go to "Database Access" in the left sidebar
2. Click "Add New Database User"
3. Select "Password" as authentication method
4. Username: `admin`
5. Click "Autogenerate Secure Password" and **save this password securely**
6. Under "Database User Privileges", select "Atlas admin"
7. Click "Add User"

#### Production App User

1. Click "Add New Database User" again
2. Username: `app_user_prod`
3. Click "Autogenerate Secure Password" and **save this password securely**
4. Under "Database User Privileges", select "Specific Privileges"
5. Click "Add Specific Privilege"
6. Set:
   - **Database**: `production`
   - **Privilege**: `readWrite`
7. Click "Add User"

### 5. Configure Network Access

1. Go to "Network Access" in the left sidebar
2. Click "Add IP Address"
3. Click "Allow Access from Anywhere"
4. This will add `0.0.0.0/0` to the IP whitelist
5. Click "Confirm"

> **Note**: For production deployments, you should restrict this to specific IP addresses or use more secure networking options.

### 6. Create Vector Search Indexes

You need to create a vector search index for **both** the `test` and `production` databases.

#### For Test Database:

1. Go to "Atlas Search" in the left sidebar
2. Click "Create Search Index"
3. Select "Vector Search" for the search type
4. Click "Next"
5. Leave the index name as `vector_index`
6. Select database: `test`
7. Select collection: `rag_vectors`
8. Click "Next"
9. Select "JSON Editor" as the configuration method
10. Paste the following configuration:

```json
{
  "fields": [
    {
      "numDimensions": 1536,
      "path": "embedding",
      "similarity": "cosine",
      "type": "vector"
    },
    {
      "path": "file_id",
      "type": "filter"
    },
    {
      "path": "source",
      "type": "filter"
    },
    {
      "path": "page",
      "type": "filter"
    },
    {
      "path": "page_label",
      "type": "filter"
    }
  ]
}
```

12. Click "Next" and then "Create Search Index"

#### For Production Database:

Repeat the same process, but select the `production` database and `rag_vectors` collection in step 7.

---

## Part 2: Local Development Setup

### 1. Clone and Create Branch

```bash
# Clone the LibreChat repository
git clone https://github.com/Actual-Reality/LibreChat.git

# Create a new branch from main
git checkout main
git pull origin main
git checkout -b app-name
```

### 2. Configure Environment Variables

```bash
# Copy the example environment file
cp .env.example .env
```

### 3. Edit the `.env` File

Open the `.env` file in your text editor and configure the following:

#### App Configuration

```bash
APP_TITLE=LibreChat
# Configure other app settings as needed
```

#### MongoDB Configuration

You'll need to construct your MongoDB connection strings using the credentials you saved earlier.

**Connection String Format:**
```
mongodb+srv://<username>:<password>@<cluster-name>.mongodb.net/<database>?retryWrites=true&w=majority
```

**For MONGO_URI (using admin user for local development):**
```bash
MONGO_URI=mongodb+srv://<user>:<password>@<cluster>.mongodb.net/test?retryWrites=true&w=majority&appName=<cluster>
```

**For ATLAS_MONGO_DB_URI (for RAG API):**
```bash
ATLAS_MONGO_DB_URI=mongodb+srv://app_user_prod:<app-user-password>@<cluster-name>.mongodb.net/production?retryWrites=true&w=majority&appName=<cluster>
```

Replace:
- `<admin-password>` with the admin user's autogenerated password
- `<app-user-password>` with the app_user_prod's autogenerated password
- `<cluster-name>` with your actual cluster name (found in Atlas under your cluster)

#### OpenAI API Configuration

```bash
OPENAI_API_KEY=sk-your-openai-api-key-here
RAG_OPENAI_API_KEY=sk-your-openai-api-key-here
```

> **Note**: You can use the same OpenAI API key for both variables.

#### Generate Security Keys

Generate the required security keys for your `.env` file:

```bash
# Generate all required security keys
echo "CREDS_KEY=$(openssl rand -hex 32)"
echo "CREDS_IV=$(openssl rand -hex 16)"
echo "JWT_SECRET=$(openssl rand -hex 32)"
echo "JWT_REFRESH_SECRET=$(openssl rand -hex 32)"
```

Copy them into your env file

### 4. Save Project-Specific Environment

Create a backup of your environment configuration for this specific project:

```bash
cp .env .env.<app_name>
```

Replace `<app_name>` with your project name (e.g., `cp .env .env.librechat-prod`).

> **Tip**: For future projects, you can quickly switch configurations by running:
> ```bash
> cp .env.<app_name> .env
> ```

### 5. Install Dependencies

```bash
npm ci
```

### 6. Start the Application

Run these commands in **separate terminal windows**:

**Terminal 1 - Frontend:**
```bash
npm run frontend
```

**Terminal 2 - RAG API (Docker):**
```bash
docker compose -f rag.yml up -d
```

**Terminal 3 - Backend:**
```bash
npm run backend
```

### 7. Access LibreChat

Once all services are running, open your browser and navigate to:

```
http://localhost:3080
```

You should see the LibreChat interface. Create an account and start chatting!

---

## Troubleshooting

### MongoDB Connection Issues

- Verify your connection strings are correctly formatted
- Ensure passwords don't contain special characters that need URL encoding
- Check that `0.0.0.0/0` is added to Network Access in Atlas

### RAG API Issues

- Ensure Docker is running
- Check RAG API logs: `docker compose -f rag.yml logs`
- Verify `ATLAS_MONGO_URI` is correctly configured

### Port Conflicts

- If port 3080 is in use, you can change it in the `.env` file with `PORT=3080`
- Frontend default port is 3090
- Backend default port is 3080

---

## Next Steps

Once you have LibreChat running locally, you can proceed to [deploy it to Railway](./DEPLOYMENT.md).
